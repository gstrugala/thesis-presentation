% MAP
\begin{slide}[Les cartes de performance doivent être complétées]

\begin{scope}[shift={(p5cl cs:1,4)}, z={(.075,.125)}, font=\footnotesize]

\def\sss{0.25}	% small square size
\def\lss{.75}	% large square size

% Global performance map
\foreach \x in {0, ..., 3}{\foreach \y in {0, ..., 3}{
	\foreach \z in {3, ..., 0}{
	\ifnum \x=3
		\ifnum \y=3
			\draw [ultra thin, fill=col!40]
		\else
			\draw [ultra thin, fill=gray!30]
		\fi
	\else
		\draw [ultra thin, fill=gray!30]
	\fi
	(\x*\lss,\y*\lss,\z) coordinate (n\x\y\z) rectangle
	(\x*\lss+\sss,\y*\lss+\sss,\z) coordinate (N\x\y\z);}}}

% Axes
\draw [gray, semithick]
	foreach \x in {0, ..., 3}{
		(n\x00)++(.5*\sss,-\baselineskip)++(0,\quantum)
		-- ++(0,-\quantum) coordinate (f\x)}
	(f0) -- node [below, yshift=-1mm] {\fc} (f3);
\draw [gray, semithick]
	foreach \y in {0, ..., 3}{
		(n0\y0)++(-\baselineskip,.5*\sss)++(\quantum,0)
		-- ++(-\quantum,0) coordinate (V\y)}
	(V0) -- node [left, xshift=-1mm] {\Va} (V3);

% labels
\draw [col] ($(N333)+(-0.5*\sss,3\quanta)$) -- ++(0,\baselineskip)
	node [anchor=base, black, font=\scriptsize, yshift=3\quanta]
		{fourni};
\draw [gray] ($(N133)+(-0.5*\sss,3\quanta)$) -- ++(0,\baselineskip)
	node [anchor=base, black, font=\scriptsize, yshift=3\quanta]
		{manquant};

% Zoom
\begin{scope}[xshift=45mm, z={(.6,1)}, visible on=<2>]

\def\squaresize{.2}
\def\pad{1.2*\squaresize}

\foreach \x in {0, ..., 3}{\foreach \y in {0, ..., 3}{
	\foreach \z in {0, ..., 3}{
		\ifnum \x=\y
			\fill [col!40]
		\else
			\fill [gray!30]
		\fi
	(\pad*\x,\pad*\y,\z) coordinate (c\x\y\z) rectangle
	(\pad*\x+\squaresize,\pad*\y+\squaresize,\z) coordinate (C\x\y\z);}}}

% Axes
\draw [gray, semithick]
	foreach \x in {0, ..., 3}{
		(c\x00)++(.5*\squaresize,-\baselineskip)++(0,\quantum)
		-- ++(0,-\quantum) coordinate (Tr\x)}
	(Tr0) -- node [below, yshift=-1mm] {\Tr} (Tr3);
\draw [gray, semithick]
	foreach \y in {0, ..., 3}{
		(c0\y0)++(-\baselineskip,.5*\squaresize)++(\quantum,0)
		-- ++(-\quantum,0) coordinate (wb\y)}
	(wb0) -- node [left, xshift=-1mm] {\Twbr} (wb3);
\draw [gray, semithick]
	foreach \z in {0, ..., 3}{
		(c00\z -| C33\z)++(\baselineskip,0)++(-\quantum,0)
		-- ++(\quantum,0) coordinate (To\z)}
	(To0) -- node [right, xshift=2mm] {\To} (To3);

\draw [ultra thin, gray]
	($(n330)+(0,\sss)$) -- ($(c000)+(0,3*\pad+\squaresize)$)
	($(N333)-(\sss,0)$) -- ($(c003)+(0,3*\pad+\squaresize)$);

\end{scope}

\end{scope}

\end{slide}





% raw heating capacity scatter
\begin{slide}[Obtenir les performances dans chaque condition\\
			  est difficile]

\begin{axis}[
	plot options,
	at={(p5cl cs:1,2)},
	font=\footnotesize,
	height=11\baselineskip, width=3\colv+2\baselineskip,
	enlargelimits=false, colorbar,
	colormap={og}{color(0)=(gray) color(35)=(gray!50) color(105)=(col!50) color(142)=(col)},
	colorbar style={major tick length=0pt,
					ytick={20, 40, ..., 140},
					yticklabels={20, 40, ..., 120, \SI{140}{\hertz}},
					xlabel={\footnotesize\fc},
					xlabel style={at={(1,1.065)},anchor=west},
					inner sep=3pt,
					xshift=11pt},
	colorbar/width=2mm,
	xmin=-22.2, ymin=0, ymax=6.9,
	xtick={-22.2, -2.8, 0, 26.6}, ytick={0, 3, 6.9},
	xticklabels={\num{-22.2}$\phantom{-}$, \num{-2.8}$\phantom{-}$, 0,
				 \phantom{\,\si{\celsius}}\SI{26.6}{\celsius}},
	yticklabels={0, 3, \SI{6.9}{\kilo\watt}}]

\addplot[only marks, scatter, scatter src=explicit, mark size=.7pt,
    	 colormap name=og]
	table[x=Toa, y=Qh, meta=f] {data/Qh-raw.tsv};

\end{axis}

\node[anchor=mid west, font=\footnotesize] at (p5cl cs:0,13) {\Qh};
\node[anchor=base west, font=\footnotesize]
	at (t5cr cs:3.5,0) {\To};

\end{slide}





% frequency regressions
\begin{slide}[Les performances sont corrigées selon la fréquence\\
			  par des régressions déduites des mesures]

\begin{groupplot}[
	group style={group size=1 by 2, vertical sep=2\baselineskip},
	plot options,
	clip=false,
	xmin=0, xmax=1, ymin=0, ymax=1,
	xtick={0, 0.332, 0.844, 1},
	xticklabels={0, 0.33, 0.84, 1},
	axis y line*=right,
	yticklabel style={xshift=6\quanta-2\ssMheight},
	width=\bigcol,
	height=5\baselineskip]

\nextgroupplot[
	visible on=<1>,
	axis x line=none,
	ytick={0, 0.405, 1},
	yticklabels={0, 0.4, 1},
	at={(p5cr cs:1,9)}]

\addplot[only marks, mark size=.7pt]
	table[x=nu, y=phi1] {data/phi-nu-heating.tsv};
\addplot[col, very thick, domain=0:1] {1.676*x -0.676*x^2}
	coordinate (phi1);
\node[left, font=\scriptsize, inner sep=3pt]
	at (axis cs:0.77,1) {measurements};
\node[left, font=\scriptsize, col, inner sep=3pt]
	at (axis cs:0.15,0.3) {fit};
	

\nextgroupplot[visible on=<1>, ytick={0, 0.16, 0.77, 1}]

\addplot[only marks, mark size=.7pt]
	table[x=nu, y=phi2] {data/phi-nu-heating.tsv};
\def\slope{1.524}
\def\intercept{0.561}
\addplot[col, very thick, domain=0:1]
	{\slope*x - \intercept*(1 - exp(-\slope*x/\intercept))}
	coordinate (phi2);

\end{groupplot}

\node[font=\scriptsize, align=left, anchor=base west]
	at (t5cl cs:1,0) {fréquence\\normalisée};
\node[font=\scriptsize, anchor=mid west]
	at (p5cl cs:4.2,14) {$ \dfrac{\Qh}{\SI{6.5}{\kilo\watt}} $};
\node[font=\scriptsize, anchor=mid west]
	at (p5cl cs:4.2,7) {$ \dfrac{\Pel}{\SI{2.87}{\kilo\watt}} $};



\begin{groupplot}[
	group style={group size=1 by 2, vertical sep=2\baselineskip},
	plot options,
	clip=false,
	xmin=0, xmax=1.28, ymin=0,
	xtick={0, 0.64, 1, 1.28},
	axis y line*=right,
	yticklabel style={xshift=6\quanta-2\ssMheight},
	width=\bigcol,
	height=5\baselineskip]

\nextgroupplot[
	visible on=<2>,
	axis x line=none,
	ymax=1.23,
	ytick={0, 0.57, 1, 1.23},
	at={(p5cr cs:1,9)}]

\addplot[only marks, mark size=.7pt]
	table[x=nu, y=phic1] {data/phi-nu-cooling.tsv};
\addplot[col, very thick, domain=0:1.28] {1.05946*x - 0.05946*x^2}
	coordinate (phi1);
\node[left, font=\scriptsize, inner sep=3pt]
	at (axis cs:0.78,0.95) {measurements};
\node[left, font=\scriptsize, col, inner sep=3pt]
	at (axis cs:0.5,0.3) {fit};
	

\nextgroupplot[
	visible on=<2>,
	ymax=1.3,
	ytick={0, 0.49, 1, 1.3},]

\addplot[only marks, mark size=.7pt]
	table[x=nu, y=phic2] {data/phi-nu-cooling.tsv};

\def\slope{1.363}
\def\intercept{0.372}
\addplot[col, very thick, domain=0:1.28]
	{\slope*x - \intercept*(1 - exp(-\slope*x/\intercept))}
	coordinate (phi2);

\end{groupplot}


\end{slide}





% MAP
\begin{slide}[Les cartes de performance doivent être complétées]

\begin{scope}[shift={(p5cl cs:1,4)}, z={(.075,.125)}, font=\footnotesize]

\def\sss{0.25}	% small square size
\def\lss{.75}	% large square size

% Global performance map
\foreach \x in {0, ..., 3}{\foreach \y in {0, ..., 3}{
	\foreach \z in {3, ..., 0}{
	\ifnum \y=3
		\draw [ultra thin, fill=col!40]
	\else
		\draw [ultra thin, fill=gray!30]
	\fi
	(\x*\lss,\y*\lss,\z) coordinate (n\x\y\z) rectangle
	(\x*\lss+\sss,\y*\lss+\sss,\z) coordinate (N\x\y\z);}}}

% Axes
\draw [gray, semithick]
	foreach \x in {0, ..., 3}{
		(n\x00)++(.5*\sss,-\baselineskip)++(0,\quantum)
		-- ++(0,-\quantum) coordinate (f\x)}
	(f0) -- node [below, yshift=-1mm] {\fc} (f3);
\draw [gray, semithick]
	foreach \y in {0, ..., 3}{
		(n0\y0)++(-\baselineskip,.5*\sss)++(\quantum,0)
		-- ++(-\quantum,0) coordinate (V\y)}
	(V0) -- node [left, xshift=-1mm] {\Va} (V3);

% labels
\draw [col] ($(N333)+(-0.5*\sss,3\quanta)$) -- ++(0,\baselineskip)
	node [anchor=base, black, font=\scriptsize, yshift=3\quanta]
		{fourni};
\draw [gray] ($(N133)+(-0.5*\sss,3\quanta)$) -- ++(0,\baselineskip)
	node [anchor=base, black, font=\scriptsize, yshift=3\quanta]
		{manquant};

% Zoom
\begin{scope}[xshift=45mm, z={(.6,1)}]

\def\squaresize{.2}
\def\pad{1.2*\squaresize}

\foreach \x in {0, ..., 3}{\foreach \y in {0, ..., 3}{
	\foreach \z in {0, ..., 3}{
		\ifnum \x=\y
			\fill [col!40]
		\else
			\fill [gray!30]
		\fi
	(\pad*\x,\pad*\y,\z) coordinate (c\x\y\z) rectangle
	(\pad*\x+\squaresize,\pad*\y+\squaresize,\z) coordinate (C\x\y\z);}}}

% Axes
\draw [gray, semithick]
	foreach \x in {0, ..., 3}{
		(c\x00)++(.5*\squaresize,-\baselineskip)++(0,\quantum)
		-- ++(0,-\quantum) coordinate (Tr\x)}
	(Tr0) -- node [below, yshift=-1mm] {\Tr} (Tr3);
\draw [gray, semithick]
	foreach \y in {0, ..., 3}{
		(c0\y0)++(-\baselineskip,.5*\squaresize)++(\quantum,0)
		-- ++(-\quantum,0) coordinate (wb\y)}
	(wb0) -- node [left, xshift=-1mm] {\Twbr} (wb3);
\draw [gray, semithick]
	foreach \z in {0, ..., 3}{
		(c00\z -| C33\z)++(\baselineskip,0)++(-\quantum,0)
		-- ++(\quantum,0) coordinate (To\z)}
	(To0) -- node [right, xshift=2mm] {\To} (To3);

\end{scope}

\end{scope}

\end{slide}
